"""  Кейс-задача № 1  Шифр Виженера  """

def vigenere_cipher(text, key, mode='encrypt'):
    """
    Основная функция шифрования/дешифрования по методу Виженера.

    Параметры:
    - text: входной текст (может быть многострочным)
    - key: ключевое слово (в нашем случае "Синергия")
    - mode: режим работы ('encrypt' — шифровать, 'decrypt' — дешифровать)

    Возвращает: обработанный текст (зашифрованный или расшифрованный)
    """
    # Определяем русский алфавит (33 буквы, без "Ё" для упрощения)
    alphabet = 'АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ'
    alphabet_len = len(alphabet)  # Сохраняем длину алфавита (33)

    # Очищаем и нормализуем ключ:
    # - оставляем только буквы (убираем цифры, знаки препинания)
    # - приводим к верхнему регистру
    key = ''.join([c.upper() for c in key if c.isalpha()])

    # Проверяем, что ключ не пустой после очистки
    if not key:
        raise ValueError("Ключ не может быть пустым!")

    result = []  # Здесь будем собирать итоговый текст
    key_index = 0  # Текущая позиция в ключе (для циклического использования)

    # Обрабатываем каждый символ входного текста по очереди
    for char in text:
        # Проверяем, является ли символ буквой русского алфавита
        if char.upper() in alphabet:
            # Находим индекс текущей буквы в алфавите
            text_idx = alphabet.index(char.upper())

            # Выбираем текущую букву ключа (циклически, по модулю длины ключа)
            key_char = key[key_index % len(key)]
            # Находим её индекс в алфавите
            key_idx = alphabet.index(key_char)

            # В зависимости от режима выполняем шифрование или дешифрование
            if mode == 'encrypt':
                # Формула шифрования: (индекс буквы + индекс буквы ключа) mod 33
                new_idx = (text_idx + key_idx) % alphabet_len
            else:
                # Формула дешифрования: (индекс зашифрованной буквы − индекс буквы ключа) mod 33
                new_idx = (text_idx - key_idx) % alphabet_len

            # Получаем новый символ из алфавита по вычисленному индексу
            new_char = alphabet[new_idx]

            # Если исходная буква была строчной, сохраняем регистр
            if char.islower():
                new_char = new_char.lower()

            # Добавляем новый символ в результат
            result.append(new_char)
            # Переходим к следующей букве ключа
            key_index += 1
        else:
            # Если символ не из алфавита (пробел, знак препинания, цифра, перевод строки):
            # - оставляем его без изменений
            # - не продвигаем позицию в ключе
            result.append(char)

    # Собираем список символов в единую строку и возвращаем
    return ''.join(result)


def read_multiline_input(prompt):
    """
    Функция для чтения многострочного ввода от пользователя.

    Параметры:
    - prompt: текст подсказки перед вводом

    Возвращает: введённый текст (с сохранением переводов строк)
    """
    print(prompt)  # Выводим подсказку
    lines = []  # Список для хранения введённых строк

    while True:
        try:
            # Читаем одну строку ввода
            line = input()

            # Если введена пустая строка — завершаем ввод
            if line == '':
                break

            # Иначе добавляем строку в список
            lines.append(line)
        except EOFError:
            # Обрабатываем случай, когда ввод завершён извне (например, через файл)
            break

    # Соединяем все строки через символ перевода строки и возвращаем
    return '\n'.join(lines)


def main():
    """
    Главная функция программы — организует пользовательский интерфейс.
    """
    key = "Синергия"  # Задаём фиксированный ключ

    # Выводим заголовок программы
    print("Шифр Виженера (ключ: «Синергия»)")

    # Основной цикл программы (работает пока пользователь не выйдет)
    while True:
        # Выводим меню действий
        print("\nВыберите действие:")
        print("1 — Зашифровать текст")
        print("2 — Дешифровать текст")
        print("3 — Выход")

        # Считываем выбор пользователя
        choice = input("\nВведите номер действия (1–3): ").strip()

        # Обработка выхода из программы
        if choice == '3':
            print("Программа завершена.")
            break  # Выходим из цикла

        # Проверка на некорректный ввод
        if choice not in ['1', '2']:
            print("Ошибка: введите 1, 2 или 3.")
            continue  # Возвращаемся к началу цикла

        # Если выбрано шифрование
        if choice == '1':
            print("\nВведите текст для шифрования (пустая строка — окончание ввода):")
            # Считываем многострочный текст
            text = read_multiline_input("")
            # Шифруем текст
            result = vigenere_cipher(text, key, 'encrypt')
            # Выводим результат
            print(f"\nЗашифрованный текст:\n{result}\n")

        # Если выбрано дешифрование
        else:
            print("\nВведите зашифрованный текст (пустая строка — окончание ввода):")
            # Считываем многострочный зашифрованный текст
            text = read_multiline_input("")
            # Дешифруем текст
            result = vigenere_cipher(text, key, 'decrypt')
            # Выводим результат
            print(f"\nДешифрованный текст:\n{result}\n")


# Точка входа в программу
if __name__ == "__main__":
    main()  # Запускаем основную функцию